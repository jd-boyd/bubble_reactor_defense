-- Tile Reactor Defense for TIC-80

MC_Game = require("mc_lib")
M3_Game = require("m3_lib")

function TIC()
    -- if btnp(4) then -- 'Z' key to shoot
    --     MC_Game:add_bullet(SCREEN_WIDTH // 2, SCREEN_HEIGHT - 10)
    -- end
    handle_input()

    cls(0)

    MC_Game:update()

    MC_Game:draw()    
    M3_Game:draw()

end

function BOOT()
   MC_Game:init()
   M3_Game:init()   
end



-- Handle input
function handle_input()
 if btnp(0) then -- Up
    M3_Game:move_up()
 elseif btnp(1) then -- Down
M3_Game:move_down()
 elseif btnp(2) then -- Left
    M3_Game:move_left()

 elseif btnp(3) then -- Right
    M3_Game:move_right()    
 elseif btnp(4) then -- Select -- d
    if input_mode == InputModes.Select then
       input_mode = InputModes.Swap
    else
       input_mode = InputModes.Select
    end
 end
end


-- <TILES>
-- 000:4444444433344433333434424234334444433044343332423242332432443444
-- 002:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
-- 003:bbbbbbbbbbbbbbbbbbbbbbbb334b433bb34443bbb34443bbb34443bbbb444bbb
-- 016:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbeebebbbbedeeeebbedededeeeeeeeee
-- 017:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbebeebbeededeebdedededeeeeeeeee
-- 018:bbbbbbbbbbbbbbbbbbbbbbbbbbb6bbbbb6b6b6bbbb6666bbbbb6bbbbbbb6bbbb
-- 019:ebcccbebbeeeeebbbbe4ebbbbbe4ebbbbbe4ebbbbbe4ebbbbbeeebbbbbbebbbb
-- 192:2222222222222222222222222222222222222222222222222222222222222222
-- 193:2222222222222222222222222222222222222222222222222222222222222222
-- 194:6666666666666666666666666666666666666666666666666666666666666666
-- 195:6666666666666666666666666666666666666666666666666666666666666666
-- 208:2222222222222222222222222222222222222222222222222222222222222222
-- 209:2222222222222222222222222222222222222222222222222222222222222222
-- 210:6666666666666666666666666666666666666666666666666666666666666666
-- 211:6666666666666666666666666666666666666666666666666666666666666666
-- 213:ccccccccc0000000c0000000c0000000c0000000c0000000c0000000c0000000
-- 214:cccccccc00000000000000000000000000000000000000000000000000000000
-- 215:cccccccc0000000c0000000c0000000c0000000c0000000c0000000c0000000c
-- 224:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 225:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 226:3333333333333333333333333333333333333333333333333333333333333333
-- 227:3333333333333333333333333333333333333333333333333333333333333333
-- 229:c0000000c0000000c0000000c0000000c0000000c0000000c0000000c0000000
-- 231:0000000c0000000c0000000c0000000c0000000c0000000c0000000c0000000c
-- 240:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 241:aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa
-- 242:3333333333333333333333333333333333333333333333333333333333333333
-- 243:3333333333333333333333333333333333333333333333333333333333333333
-- 245:c0000000c0000000c0000000c0000000c0000000c0000000c0000000cccccccc
-- 246:00000000000000000000000000000000000000000000000000000000cccccccc
-- 247:0000000c0000000c0000000c0000000c0000000c0000000c0000000ccccccccc
-- </TILES>

-- <MAP>
-- 000:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 001:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:200111202021110120202120111120101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:000000000000000000000000000000101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 016:101010101010101010101010101010101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
-- </SFX>

-- <TRACKS>
-- 000:100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </TRACKS>

-- <PALETTE>
-- 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
-- </PALETTE>

