-- title:   Tile Reactor Defense
-- author:  jdboyd@jdboyd.net
-- desc:    A mashup of a match-3 tile game and missile command.
-- site:    https://github.com/jd-boyd/bubble_reactor_defense/
-- license: BSD License
-- version: 0.1
-- script:  lua

Events = require("events")
MC_Game = require("mc_lib")
M3_Game = require("m3_lib")
mc = {}
m3 = {}
events = Events:new()

function TIC()
    -- if btnp(4) then -- 'Z' key to shoot
    --     MC_Game:add_bullet(SCREEN_WIDTH // 2, SCREEN_HEIGHT - 10)
    -- end
    handle_input()

    mc:update()

    cls(0)
    mc:draw()    
    m3:draw()
end

function BOOT()
   mc = MC_Game:new()
   m3 = M3_Game:new()
   mc:init(events)
   m3:init(events)   
end

-- Handle input
function handle_input()
 if btnp(0) then -- Up
    m3:move_up()
 elseif btnp(1) then -- Down
    m3:move_down()
 elseif btnp(2) then -- Left
    m3:move_left()
 elseif btnp(3) then -- Right
    m3:move_right()    
 elseif btnp(4) then -- Select -- d
    if m3.input_mode == InputModes.Select then
       m3.input_mode = InputModes.Swap
    else
       m3.input_mode = InputModes.Select
    end
 end
end


-- <TILES>
-- 000:4444444433344433333434424234334444433044343332423242332432443444
-- 002:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
-- 003:0000000000000000000000003340433003444300034443000344430000444000
-- 005:0000000000000d00000c000000000000000000000000000000000c0000000000
-- 006:000000000000000000000c000000000000c00000000000000000000000000000
-- 007:00000000000d000000dcd000000d00000000000000000d000000dcd000000d00
-- 008:0000000000000d000000dcd000d00d000dcd000000d000000000000000000000
-- 009:000d000000dcd0000dcccd0000dcd000000d0d000000dcd0000dcccd0000dcd0
-- 010:00000d000000dcd000ddcccd0dcddcd0dcccdd000dcd000000d0000000000000
-- 011:00dcd0000dcccd00dcccccd00dcccd0000dcdcdd000dcccd00dccccc000dcccd
-- 012:0000dcd000ddcccd0dccccccdccccccdccccccd0dcccdd00ddcd0000d00000d0
-- 016:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbeebebbbbedeeeebbedededeeeeeeeee
-- 017:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbebeebbeededeebdedededeeeeeeeee
-- 018:bbbbbbbbbbbbbbbbbbbbbbbbbbb6bbbbb6b6b6bbbb6666bbbbb6bbbbbbb6bbbb
-- 019:e0ccc0e00eeeee0000e4e00000e4e00000e4e00000e4e00000eee000000e0000
-- 021:000000000000000000000c0000000000000000000000000000000000000000c0
-- 022:0000000000000000000000c0000000000000000000c000000000000000000000
-- 023:00000000000000d000000dcd000000d00000000000000d000000dcd000000d00
-- 024:00000000000000d000000dcd000000d000d000000dcd000000d0000000000000
-- 025:00000dd000000dcd0000dccc00000dcd00000dd00000dcd0000dcccd0000dcd0
-- 026:000000d000000dcdd000dccc00d00dcd0dcd00d0dcccd0000dcd000000d00000
-- 027:0000dccd0000dccc000dcccc0000dccc0000dccd000dcccd00dccccc000dcccd
-- 028:00000dcdd000dccccd0dccccddcddcccdcccddcdcccccdd0dcccd0000dcd0000
-- 066:0000000000000000000000000004400000044000000000000000000000000000
-- 067:0000000000000000000330000034433000344300000330000000000000000000
-- 068:000000000033330003444430034cc430034cc430034444300033330000000000
-- 160:0000000000000004000000040000004400000044000044440444444400444444
-- 161:0000000040000000400000004400000044000000444400004444444044444400
-- 162:000000000fffffff0fffffff0fffffff0fffffff0fffffff0fffffff0fffffff
-- 163:00000000fffffff0fffffff0fffffff0fffffff0fffffff0fffffff0fffffff0
-- 176:0000444400000444000004440000444400004444000444400044400000000000
-- 177:4444000044400000444000004444000044440000044440000004440000000000
-- 178:0fffffff0fffffff0fffffff0fffffff0fffffff0fffffff0fffffff00000000
-- 179:fffffff0fffffff0fffffff0fffffff0fffffff0fffffff0fffffff000000000
-- 192:0000000000022200002222200222222202222222022222220222222200222222
-- 193:0000000000222000022222002222222022222220222222202222222022222200
-- 194:0000000000000006000000660000066600006666000666660066666606666666
-- 195:0000000060000000660000006660000066660000666660006666660066666660
-- 208:0022222200022222000222220000222200000222000000220000000200000000
-- 209:2222220022222000222220002222000022200000220000002000000000000000
-- 210:0666666600666666000666660000666600000666000000660000000600000000
-- 211:6666666066666600666660006666000066600000660000006000000000000000
-- 213:ccccccccc0000000c0000000c0000000c0000000c0000000c0000000c0000000
-- 214:cccccccc00000000000000000000000000000000000000000000000000000000
-- 215:cccccccc0000000c0000000c0000000c0000000c0000000c0000000c0000000c
-- 224:00000000000000aa0000aaaa000aaaaa00aaaaaa00aaaaaa0aaaaaaa0aaaaaaa
-- 225:00000000aa000000aaaa0000aaaaa000aaaaaa00aaaaaa00aaaaaaa0aaaaaaa0
-- 226:0000000000000003000000030000003300000033000003330000033300003333
-- 227:0000000030000000300000003300000033000000333000003330000033330000
-- 229:c0000000c0000000c0000000c0000000c0000000c0000000c0000000c0000000
-- 231:0000000c0000000c0000000c0000000c0000000c0000000c0000000c0000000c
-- 240:0aaaaaaa0aaaaaaa00aaaaaa00aaaaaa000aaaaa0000aaaa000000aa00000000
-- 241:aaaaaaa0aaaaaaa0aaaaaa00aaaaaa00aaaaa000aaaa0000aa00000000000000
-- 242:0000333300033333000333330033333300333333033333330333333300000000
-- 243:3333000033333000333330003333330033333300333333303333333000000000
-- 245:c0000000c0000000c0000000c0000000c0000000c0000000c0000000cccccccc
-- 246:00000000000000000000000000000000000000000000000000000000cccccccc
-- 247:0000000c0000000c0000000c0000000c0000000c0000000c0000000ccccccccc
-- </TILES>

-- <MAP>
-- 000:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 001:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 002:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 003:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 004:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 005:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 006:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 007:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 008:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:202020202020202020202020202020101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:200111202021110120202120111120101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 016:000000000000000000000000000000101010101010101010101010101010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:00000000ffffffff00000000ffffffff
-- 001:0123456789abcdeffedcba9876543210
-- 002:0123456789abcdef0123456789abcdef
-- </WAVES>

-- <SFX>
-- 000:000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304000000000
-- </SFX>

-- <TRACKS>
-- 000:100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </TRACKS>

-- <PALETTE>
-- 000:1a1c2c5d275db13e53ef7d57ffcd75a7f07038b76425717929366f3b5dc941a6f673eff7f4f4f494b0c2566c86333c57
-- </PALETTE>

